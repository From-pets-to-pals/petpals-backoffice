<app-location (updatedLocation)="GetLocationData($event)"></app-location>
<form [formGroup]="form" class="form_create_owner" autocomplete="off">
	<mat-form-field>
		<mat-label>Username</mat-label>
		<input type="text" formControlName="username" name="username" matInput maxlength="35"
		       class="input_create_owner" autocomplete="off" [required]="true"
		       placeholder="Ex. Sidney">
	</mat-form-field>
	<mat-form-field hintLabel="Max 10 char1acters">
		<mat-label>Email</mat-label>
		<input type="email" formControlName="email" matInput maxlength="100" class="input_create_owner"
		       name="email" autocomplete="off" [required]="true"
		       placeholder="Ex. my-doggo@gmail.com">
		<mat-hint align="end">{{ form.get("email")!.value.length }}/100</mat-hint>
	</mat-form-field>
	<mat-form-field hintLabel="Max 10 characters">
		<mat-label>Téléphone</mat-label>
		<input formControlName="phoneNumber" type="tel" matInput maxlength="10" class="input_create_owner"
		       name="phoneNumber" autocomplete="off" [required]="true"
		       placeholder="Ex. 0610203040">
		<mat-hint align="end">{{ form.get("phoneNumber")!.value.length }}/10</mat-hint>
	</mat-form-field>
	<mat-divider></mat-divider>
	<mat-accordion>
		<mat-expansion-panel (opened)="panelOpenState = true"
		                     (closed)="panelOpenState = false">
			<mat-expansion-panel-header>
				<mat-panel-title>
					Pal(s)
				</mat-panel-title>
			</mat-expansion-panel-header>
			<mat-panel-description>
				The pal(s) you want to register with
			</mat-panel-description>
			<div style="display: flex; max-width: 580px; overflow: scroll;"
			     formArrayName="pals">
				<div *ngFor="let pal of this.form.controls.pals.controls;
					let i = index">
					<div formArrayName="{{i}}" style="margin: 30px">
						<mat-stepper orientation="vertical" [linear]="true" #stepper>
							<mat-step [stepControl]="pal.controls.palIdentityInformation">
								<ng-template matStepperIcon="edit">
									<mat-icon>
										<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
											<path fill="#fdf4fc" d="M18 4c-1.71 0-2.75.33-3.35.61C13.88 4.23 13 4 12 4s-1.88.23-2.65.61C8.75 4.33 7.71 4 6 4c-3 0-5 8-5 10c0 .83 1.32 1.59 3.14 1.9c.64 2.24 3.66 3.95 7.36 4.1v-4.28c-.59-.37-1.5-1.04-1.5-1.72c0-1 2-1 2-1s2 0 2 1c0 .68-.91 1.35-1.5 1.72V20c3.7-.15 6.72-1.86 7.36-4.1C21.68 15.59 23 14.83 23 14c0-2-2-10-5-10M4.15 13.87c-.5-.12-.89-.26-1.15-.37c.25-2.77 2.2-7.1 3.05-7.5c.54 0 .95.06 1.32.11c-2.1 2.31-2.93 5.93-3.22 7.76M9 12a1 1 0 0 1-1-1c0-.54.45-1 1-1a1 1 0 0 1 1 1c0 .56-.45 1-1 1m6 0a1 1 0 0 1-1-1c0-.54.45-1 1-1a1 1 0 0 1 1 1c0 .56-.45 1-1 1m4.85 1.87c-.29-1.83-1.12-5.45-3.22-7.76c.37-.05.78-.11 1.32-.11c.85.4 2.8 4.73 3.05 7.5c-.25.11-.64.25-1.15.37" />
										</svg>
									</mat-icon>
								</ng-template>
								<ng-template matStepLabel>Pal Identity</ng-template>
								<form [formGroup]="pal.controls.palIdentityInformation">
									<mat-form-field hintLabel="Max 15 characters">
										<mat-label>ICAD</mat-label>
										<input type="text" matInput maxlength="15" class="input_create_owner"
										       name="icadIdentifier" autocomplete="off"
										       formControlName="icadIdentifier"
										       placeholder="250...">
									</mat-form-field>
									<mat-form-field hintLabel="Max 25 characters">
										<mat-label>Name</mat-label>
										<input type="text" matInput maxlength="10" class="input_create_owner"
										       name="name" autocomplete="off"
										       formControlName="name"
										       placeholder="Ashe">
									</mat-form-field>
									<mat-form-field hintLabel="Max 25 characters">
										<mat-label>Short name</mat-label>
										<input type="tel" matInput maxlength="10" class="input_create_owner"
										       name="name" autocomplete="off"
										       formControlName="shortName"
										       placeholder="Ashe">
									</mat-form-field>
									<mat-form-field hintLabel="Max 25 characters">
										<mat-label>Birthdate</mat-label>
										<input type="date" matInput [max]="maxBirthDate" class="input_create_owner"
										       [required]="true"
										       formControlName="birthDate"
										       autocomplete="off">
									</mat-form-field>
									<mat-form-field hintLabel="Select a specie">
										<mat-label>Espèce</mat-label>
										<mat-select id="pal_specie" [required]="true"
										            formControlName="specie" class="input_create_owner"
										>
											<mat-option *ngFor="let option of speciesOptions;" [value]="option.value"
											>{{ option.label }}
											</mat-option>
										</mat-select>
									</mat-form-field>
									<mat-form-field hintLabel="Fill in the breed Max 50 characters">
										<mat-label>Breed</mat-label>
										<input type="tel" matInput maxlength="50" class="input_create_owner"
										       name="breed" autocomplete="off" [required]="true"
										       formControlName="breed"

										       placeholder="Ashe">
									</mat-form-field>
									<mat-form-field hintLabel="Select pal sex">
										<mat-label>Sex</mat-label>
										<mat-select id="pal_is_male" [required]="true"
										            formControlName="isMale" class="input_create_owner"
										>
											<mat-option *ngFor="let option of sexOptions;"
											            [value]="option.value">{{ option.label }}
											</mat-option>
										</mat-select>
									</mat-form-field>
									<mat-form-field hintLabel="Pal has passport ?">
										<mat-label>Passeport européen</mat-label>
										<mat-select id="pal_has_passport" [required]="true"
										            formControlName="hasPassport" class="input_create_owner"
										>
											<mat-option *ngFor="let option of passportOptions;"
											            [value]="option.value">{{ option.label }}
											</mat-option>
										</mat-select>
									</mat-form-field>
									<div>
										<button mat-button matStepperPrevious>Back</button>
										<button mat-button matStepperNext>Next</button>
									</div>
								</form>
							</mat-step>
							<mat-step [stepControl]="pal.controls.palMedicalInformation"
							          label="Pal Medical Information">
								<ng-template matStepperIcon="edit">
									<mat-icon>
										<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
											<path fill="#fdf4fc" d="M18 4c-1.71 0-2.75.33-3.35.61C13.88 4.23 13 4 12 4s-1.88.23-2.65.61C8.75 4.33 7.71 4 6 4c-3 0-5 8-5 10c0 .83 1.32 1.59 3.14 1.9c.64 2.24 3.66 3.95 7.36 4.1v-4.28c-.59-.37-1.5-1.04-1.5-1.72c0-1 2-1 2-1s2 0 2 1c0 .68-.91 1.35-1.5 1.72V20c3.7-.15 6.72-1.86 7.36-4.1C21.68 15.59 23 14.83 23 14c0-2-2-10-5-10M4.15 13.87c-.5-.12-.89-.26-1.15-.37c.25-2.77 2.2-7.1 3.05-7.5c.54 0 .95.06 1.32.11c-2.1 2.31-2.93 5.93-3.22 7.76M9 12a1 1 0 0 1-1-1c0-.54.45-1 1-1a1 1 0 0 1 1 1c0 .56-.45 1-1 1m6 0a1 1 0 0 1-1-1c0-.54.45-1 1-1a1 1 0 0 1 1 1c0 .56-.45 1-1 1m4.85 1.87c-.29-1.83-1.12-5.45-3.22-7.76c.37-.05.78-.11 1.32-.11c.85.4 2.8 4.73 3.05 7.5c-.25.11-.64.25-1.15.37" />
										</svg>
									</mat-icon>
								</ng-template>
								<form [formGroup]="pal.controls.palMedicalInformation">
									<mat-form-field hintLabel="Pal vaccines up to date ?">
										<mat-label>Vacciné</mat-label>
										<mat-select id="pal_is_vaccinated" [required]="true"
										            formControlName="isVaccinated" class="input_create_owner">
											<mat-option *ngFor="let option of passportOptions;"
											            [value]="option.value">{{ option.label }}
											</mat-option>
										</mat-select>
									</mat-form-field>
									<mat-form-field hintLabel="Pal vaccines up to date ?">
										<mat-label>Stérilisé</mat-label>
										<mat-select id="pal_is_sterilized" [required]="true"
										            formControlName="isSterilized">
											<mat-option *ngFor="let option of passportOptions;"
											            [value]="option.value">{{ option.label }}
											</mat-option>
										</mat-select>
									</mat-form-field>
									<mat-form-field>
										<mat-label>Next vaccine</mat-label>
										<input type="date" matInput [min]="minDate" class="input_create_owner"
										       autocomplete="off" formControlName="nextVaccine">
									</mat-form-field>
									<div>
										<button mat-button matStepperPrevious>Back</button>
										<button mat-button matStepperNext>Next</button>
									</div>
								</form>
							</mat-step>
							<mat-step [stepControl]="pal.controls.palMeasurement" label="Measurements">
								<ng-template matStepperIcon="edit">
									<mat-icon>
										<svg xmlns="http://www.w3.org/2000/svg"
										     viewBox="0 0 24 24">
											<path fill="#fdf4fc" fill-rule="evenodd" d="M11.75 6.406c-1.48 0-1.628.157-2.394.157C8.718 6.563 6.802 5 5.845 5c-.958 0-2.075.563-2.075 2.188v1.875c.002.492.18 2 .88 1.597c-.827.978-.91 2.119-.899 3.223c-.223.064-.45.137-.671.212c-.684.234-1.41.532-1.737.744a.75.75 0 0 0 .814 1.26c.156-.101.721-.35 1.408-.585l.228-.075c.046.433.161.83.332 1.19l-.024.013c-.41.216-.79.465-1.032.623l-.113.074a.75.75 0 1 0 .814 1.26l.131-.086c.245-.16.559-.365.901-.545c.08-.043.157-.081.231-.116C6.763 19.475 9.87 20 11.75 20s4.987-.525 6.717-2.148c.074.035.15.073.231.116c.342.18.656.385.901.545l.131.086a.75.75 0 0 0 .814-1.26l-.113-.074a13.008 13.008 0 0 0-1.032-.623l-.024-.013c.171-.36.286-.757.332-1.19l.228.075c.687.235 1.252.484 1.409.585a.75.75 0 0 0 .813-1.26c-.327-.212-1.053-.51-1.736-.744a16.343 16.343 0 0 0-.672-.213c.012-1.104-.072-2.244-.9-3.222c.7.403.88-1.105.881-1.598V7.188C19.73 5.563 18.613 5 17.655 5c-.957 0-2.873 1.563-3.51 1.563c-.767 0-.915-.157-2.395-.157m-.675 9.194c.202-.069.441-.1.675-.1c.234 0 .473.031.676.1c.1.034.22.088.328.174a.619.619 0 0 1 .246.476c0 .23-.139.39-.246.476c-.107.086-.229.14-.328.174a2.15 2.15 0 0 1-.676.1a2.14 2.14 0 0 1-.675-.1a1.078 1.078 0 0 1-.329-.174a.619.619 0 0 1-.246-.476c0-.23.139-.39.246-.476c.107-.086.23-.14.329-.174m2.845-3.1c.137-.228.406-.5.81-.5s.674.272.81.5c.142.239.21.527.21.813c0 .285-.068.573-.21.811c-.136.229-.406.501-.81.501s-.673-.272-.81-.5a1.596 1.596 0 0 1-.21-.812c0-.286.068-.574.21-.812m-5.96 0c.137-.228.406-.5.81-.5s.674.272.81.5c.142.239.21.527.21.813c0 .285-.068.573-.21.811c-.136.229-.406.501-.81.501s-.673-.272-.81-.5a1.596 1.596 0 0 1-.21-.812c0-.286.068-.574.21-.812" clip-rule="evenodd" />
										</svg>
									</mat-icon>
								</ng-template>
								<form [formGroup]="pal.controls.palMeasurement">
									<mat-form-field hintLabel="Pal weight (kg)">
										<mat-label>Weight</mat-label>
										<input type="number" matInput maxlength="10"
										       name="weight" autocomplete="off" formControlName="weight"
										       [min]="0.1" [max]="500.0" [step]="0.2" class="input_create_owner"
										       placeholder="0.1">
									</mat-form-field>
									<mat-form-field hintLabel="Pal height (cm)">
										<mat-label>Height</mat-label>
										<input type="number" matInput maxlength="10" class="input_create_owner"
										       name="height" autocomplete="off" formControlName="height"
										       [min]="0.1" [max]="1000.0" [step]="0.2"
										       placeholder="0.1">
									</mat-form-field>

									<div>
										<button mat-button matStepperPrevious>Back</button>
										<button mat-button matStepperNext>Next</button>
									</div>
								</form>
							</mat-step>
						</mat-stepper>
						@if (i === 0) {
							@if(this.form.controls.pals.controls.length > 1) {

								<button mat-flat-button type="button" color="primary" class="button_create_caregiver"
								        disabled
								        style="margin: auto"
								        (click)="RemovePal(i)">Remove
								</button>
							}
						} @else {
							<button mat-flat-button type="button" color="primary" class="button_create_caregiver"
							        style="margin: 15px;left:40px"
							        (click)="RemovePal(i)">Remove
							</button>
						}
					</div>
				</div>
			</div>
			<div style="justify-content: space-around; display: flex">
				<button mat-flat-button type="button" color="primary" class="button_create_caregiver"
				        (click)="AddPalToList()">Add
					another pal
				</button>
				@if (form.controls["pals"].value.length > 1) {
					<button mat-flat-button type="button" color="primary" class="button_create_caregiver"
					        (click)="RemoveLastPal()">Remove last pal
					</button>
				}
			</div>
		</mat-expansion-panel>
	</mat-accordion>
	<mat-divider>
	</mat-divider>
	<button mat-flat-button type="button" color="primary" class="button_create_caregiver" (click)="ShowList()">
		Enregistrer
	</button>
</form>